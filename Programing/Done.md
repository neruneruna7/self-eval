### バグレポート
開発バイト先において，わかりやすいバグレポートを記述することができた．
他のエンジニアからも，「細かく記述したことにより課題、原因、解決策まで追いやすくとても助かった」との言葉をいただいた．

#### 経緯

事象：特定のページからブラウザバックできない

以下，ページのことをPと表記する．ページA -> Pa  
次のような遷移があった．  
- Pa -> Pb
- Pb -> Pc
- Pa -> Pc
このうち，Pa -> Pcでのブラウザバックができない事象が起きていた．
Pa -> Pb，Pb -> Pcにおいては正常にブラウザバックできることが確認済みである．


#### 調査
まずはブラウザから見た挙動を調査した．
どのように調査したかをレポートに記述したので，内容をぼかしながら実際の調査レポートを載せる．

```
ブラウザのhistoryを使用して調査した
ブラウザのhistoryとは？これは，ブラウザバックなどの際にどこに遷移するかを管理しているブラウザの機能
`history.state`で状態を確認できる
`history.back()`でブラウザバックと同じ挙動をする
参考:https://developer.mozilla.org/ja/docs/Web/API/History

このstateに含まれる，idxを追っていく．

PaからPbが存在するページに飛ぶ際の挙動
例えば，*ぼかし*など
-> は次のページへの遷移
<- はブラウザバックを表している

Pa -> Pb
state  idx: 0 -> idx:  1

Pb -> Pc
state idx: 1 -> idx: 2

ブラウザバック
Pb <- Pc
state idx: 1 <- idx: 2

Pa <- Pb
state  idx: 0 <- idx:  1

正常

PaからPbが存在しない，Pcへ飛ぶページに飛ぶ際の挙動
*ぼかし*など

Pa -> (Pb) -> (??) -> Pc
state idx: 0 -> (Pb?) -> (??) -> idx: 3

Pcからブラウザバック時の挙動
?? <- Pc
state: idx: 2 <- idx: 3

画面遷移は起こらず，stateが1つ減った．謎の状態が挟まっている

??からブラウザバックしたときの挙動
Pb <- ??
state: idx: 1 <- idx: 2

上記のように，一瞬だけURL欄にPbとなっているのを確認．Pbへのブラウザバック自体は発生している
直後に以下の挙動が発生した
Pb -> ?? -> Pcが発生
idx: 1 -> (??) -> idx: 3

以上から得られる結論
ブラウザバック動作自体は，不明な状態を挟んでいるものの動作している
Pa -> Pb -> 不明な状態 -> Pc
のように状態が並んでいる

しかし，Pb <- 不明な状態にブラウザバックする際に次の挙動が発生
Pbに遷移した瞬間に
Pbに -> 不明な状態 -> Pc

これにより無限ループが発生し，Paへブラウザバックできなくなっている．
```

#### バグレポート
以下のようなバグレポートを作成した．実際はこれに加え具体的な解決策を記述している．
```
ブラウザバックできない問題をコードも見て調査しました タネがわかれば解決法は簡単そうです

PcからPaへブラウザバックできない問題は，PcからPbにブラウザバックする際，即座にPbからPcへの遷移が起こることによって生じる．
すなわち，以下の手段によって回避可能である
Pbからスポットへの遷移が起こる前に，連打して無理やりPaまでブラウザバックする
PaからPbに飛ぶか，Pcへ飛ぶかの制御をPbで行うのではなく，Paで行う
ブラウザのhistoryを操作し，Pbに飛んだということを無かったことにする

ブラウザバック問題は以上で終了だが，伴って別の異常が発見されている．
ページの履歴に異常が生じている．ブラウザのhistoryにより確認
本来ならば，
Pa idx0 -> Pb idx1 -> Pc idx2
というhistoryとなるはずである．
しかし
Pa idx0 -> Pb idx1 -> X idx2 -> Pc idx3
というhistoryになっている
idx3のときにブラウザバックしても，idx2になるだけで画面に変化は生じない．
すなわち，ReactがDOMに差分を検出しなかったと考えられ．XとPcは同一の画面構成だと考えられる．

この原因はPb.tsxのuseEffectにあった．
ReactのStrictModeにより，コンポーネントは2回レンダリングされる．
このuseEffectは実行されると，Pcへの遷移が起動するようになっている．
これにより，Pcへの遷移が2回発生し，1度目の遷移はidx2のXに，2回目の遷移はidx3のPcになるものと考えられる．
```
